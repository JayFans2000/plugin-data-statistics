!function(){"use strict";let t={"xhhaocom-dataStatistics-v2-traffic":"xhhaocom-dataStatistics-v2-traffic-loading","xhhaocom-dataStatistics-v2-activity":"xhhaocom-dataStatistics-v2-activity-loading","xhhaocom-dataStatistics-v2-uptime-kuma":"xhhaocom-dataStatistics-v2-uptime-kuma-loading","xhhaocom-dataStatistics-v2-github-pin":"xhhaocom-dataStatistics-v2-github-loading","xhhaocom-dataStatistics-v2-github-stats":"xhhaocom-dataStatistics-v2-github-loading","xhhaocom-dataStatistics-v2-github-top-langs":"xhhaocom-dataStatistics-v2-github-loading","xhhaocom-dataStatistics-v2-github-graph":"xhhaocom-dataStatistics-v2-github-loading"};function a(a){let e=a.className,i=t[e]||"xhhaocom-dataStatistics-v2-github-loading";a.innerHTML=`<div class="${i}">加载中</div>`}function e(t){return t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString()}function i(t){return null==t?0:"object"==typeof t&&"value"in t?parseInt(t.value)||0:parseInt(t)||0}function s(t){return fetch(t).then(t=>{if(!t.ok)throw Error(`HTTP ${t.status}`);return t.json()})}let c="undefined"!=typeof Intl&&"function"==typeof Intl.DisplayNames?new Intl.DisplayNames(["zh-CN"],{type:"region"}):null,o={HK:"中国香港",MO:"中国澳门",TW:"中国台湾"},n={"chart-line":'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>',"account-group":'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>',account:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',fire:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg>',"lightning-bolt":'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>',eye:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>'},r={daily:"今日概览",weekly:"近7天趋势",monthly:"近30天趋势",quarterly:"近90天趋势",yearly:"近一年趋势"};function l(t,a=24){let e=n[t];return e?e.replace('viewBox="0 0 24 24"',`viewBox="0 0 24 24" width="${a}" height="${a}"`):""}function d(t,a,i,s=!1){let c=document.createElement("div");c.className="xhhaocom-dataStatistics-v2-traffic-card",c.setAttribute("data-variant",s?"realtime":"history");let o=document.createElement("span");o.className="xhhaocom-dataStatistics-v2-traffic-icon",o.innerHTML=l(t,24);let n=document.createElement("div");n.className="xhhaocom-dataStatistics-v2-traffic-value",n.textContent=e(a);let r=document.createElement("div");if(r.className="xhhaocom-dataStatistics-v2-traffic-label",r.textContent=i,c.appendChild(o),c.appendChild(n),c.appendChild(r),s){let d=document.createElement("div");d.className="xhhaocom-dataStatistics-v2-traffic-realtime",d.dataset.tooltip="实时数据",c.appendChild(d)}return c}function h(t,a,i){let s=document.createElement("div");s.className="xhhaocom-dataStatistics-v2-activity-metric";let c=document.createElement("span");c.className="xhhaocom-dataStatistics-v2-activity-metric-icon",c.innerHTML=l(t,18);let o=document.createElement("div");o.className="xhhaocom-dataStatistics-v2-activity-metric-content";let n=document.createElement("div");n.className="xhhaocom-dataStatistics-v2-activity-metric-value",n.textContent=e(a);let r=document.createElement("div");return r.className="xhhaocom-dataStatistics-v2-activity-metric-label",r.textContent=i,o.appendChild(n),o.appendChild(r),s.appendChild(c),s.appendChild(o),s}let p=null;function u(){return p?Promise.resolve(p):s("/apis/api.data.statistics.xhhao.com/v1alpha1/github/config").then(t=>(p=t,t))}function v(t,a,e,i){let s=document.createElement("img");s.src=a,s.alt=e,s.style.maxWidth="100%",s.onerror=()=>{t.innerHTML=`<div class="${i}">加载失败</div>`},t.innerHTML="",t.appendChild(s)}function m(t){t.className="xhhaocom-dataStatistics-v2-github-pin",a(t);let e=t.getAttribute("data-repo")||"";u().then(a=>{if(!a.username)throw Error("GitHub 用户名未配置");let i=new URLSearchParams;i.append("username",a.username),e&&i.append("repo",e);let s=a.proxyUrl+"api/pin/?"+i.toString();v(t,s,"GitHub Repository Stats","xhhaocom-dataStatistics-v2-github-error")}).catch(a=>{console.error("[GitHub Pin]",a),t.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'})}function g(t){t.className="xhhaocom-dataStatistics-v2-github-stats",a(t);let e=t.getAttribute("data-locale")||"",i=t.getAttribute("data-show-icons")||"",s=t.getAttribute("data-theme")||"";u().then(a=>{if(!a.username)throw Error("GitHub 用户名未配置");let c=new URLSearchParams;c.append("username",a.username),e&&c.append("locale",e),i&&c.append("show_icons",i),s&&c.append("theme",s);let o=a.proxyUrl+"api?"+c.toString();v(t,o,"GitHub Stats","xhhaocom-dataStatistics-v2-github-error")}).catch(a=>{console.error("[GitHub Stats]",a),t.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'})}function f(t){t.className="xhhaocom-dataStatistics-v2-github-top-langs",a(t);let e=t.getAttribute("data-layout")||"",i=t.getAttribute("data-hide-progress")||"",s=t.getAttribute("data-stats-format")||"";u().then(a=>{if(!a.username)throw Error("GitHub 用户名未配置");let c=new URLSearchParams;c.append("username",a.username),e&&c.append("layout",e),i&&c.append("hide_progress",i),s&&c.append("stats_format",s);let o=a.proxyUrl+"api/top-langs/?"+c.toString();v(t,o,"GitHub Top Languages","xhhaocom-dataStatistics-v2-github-error")}).catch(a=>{console.error("[GitHub Top Langs]",a),t.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'})}function x(t){t.className="xhhaocom-dataStatistics-v2-github-graph",a(t);let e=t.getAttribute("data-theme")||"minimal";u().then(a=>{if(!a.username)throw Error("GitHub 用户名未配置");let i=new URLSearchParams;i.append("username",a.username),e&&i.append("theme",e);let s=a.graphProxyUrl+"graph?"+i.toString();v(t,s,"GitHub Activity Graph","xhhaocom-dataStatistics-v2-github-error")}).catch(a=>{console.error("[GitHub Graph]",a),t.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'})}let b={stats:g,pin:m,"top-langs":f,graph:x},$={traffic:function t(c,o){c.className="xhhaocom-dataStatistics-v2-traffic",a(c);let n=c.getAttribute("data-type")||"weekly",l=`/apis/api.data.statistics.xhhao.com/v1alpha1/umami/visits?type=${n}`,h="/apis/api.data.statistics.xhhao.com/v1alpha1/umami/realtime";Promise.all([s(l),s(h)]).then(([t,a])=>{if(!t&&!a){c.innerHTML='<div class="xhhaocom-dataStatistics-v2-traffic-loading">暂无数据</div>';return}c.innerHTML="";let e=document.createElement("div");e.className="xhhaocom-dataStatistics-v2-traffic-section";let s=document.createElement("div");s.className="xhhaocom-dataStatistics-v2-traffic-header",s.innerHTML=`
                <div class="xhhaocom-dataStatistics-v2-traffic-title-box">
                    <span class="xhhaocom-dataStatistics-v2-traffic-title">访问统计</span>
                    <span class="xhhaocom-dataStatistics-v2-traffic-badge">${r[n]||"访问概览"}</span>
                </div>
                <span class="xhhaocom-dataStatistics-v2-traffic-subtitle">历史与实时数据一目了然</span>
            `,e.appendChild(s);let o=document.createElement("div");if(o.className="xhhaocom-dataStatistics-v2-traffic-grid",e.appendChild(o),t){let l=i(t.pageviews),h=i(t.visits),p=i(t.visitors);o.appendChild(d("chart-line",l,"页面浏览量")),o.appendChild(d("account-group",h,"访问次数")),o.appendChild(d("account",p,"访客数"))}if(a?.totals){let u=parseInt(a.totals.views)||0,v=parseInt(a.totals.visitors)||0;(u>0||v>0)&&(o.appendChild(d("fire",u,"实时浏览量",!0)),o.appendChild(d("lightning-bolt",v,"实时访客",!0)))}c.appendChild(e),0===c.children.length&&(c.innerHTML='<div class="xhhaocom-dataStatistics-v2-traffic-loading">暂无数据</div>')}).catch(t=>{console.error("[Traffic Stats]",t),c.innerHTML='<div class="xhhaocom-dataStatistics-v2-traffic-error">加载失败</div>'});let p=()=>{s(h).then(t=>{if(t?.totals){let a=c.querySelectorAll(".xhhaocom-dataStatistics-v2-traffic-card"),i=parseInt(t.totals.views)||0,s=parseInt(t.totals.visitors)||0;a.forEach(t=>{let a=t.querySelector(".xhhaocom-dataStatistics-v2-traffic-label")?.textContent,c=t.querySelector(".xhhaocom-dataStatistics-v2-traffic-value");c&&("实时浏览量"===a?c.textContent=e(i):"实时访客"===a&&(c.textContent=e(s)))})}}).catch(t=>console.error("[Realtime Update]",t))};setTimeout(p,1e3);let u=setInterval(p,3e4);c.setAttribute("data-cleanup",u)},activity:function t(e,i){e.className="xhhaocom-dataStatistics-v2-activity",a(e);let n=()=>{s("/apis/api.data.statistics.xhhao.com/v1alpha1/umami/realtime").then(t=>{if(!t?.events||!Array.isArray(t.events)||0===t.events.length){e.innerHTML='<div class="xhhaocom-dataStatistics-v2-activity-empty">暂无活动</div>';return}e.innerHTML="";let a=document.createElement("div");a.className="xhhaocom-dataStatistics-v2-activity-section";let i=document.createElement("div");i.className="xhhaocom-dataStatistics-v2-activity-header",i.innerHTML=`
                        <div class="xhhaocom-dataStatistics-v2-activity-title-box">
                            <span class="xhhaocom-dataStatistics-v2-activity-title">近30分钟网站活动</span>
                            <span class="xhhaocom-dataStatistics-v2-activity-badge-wrapper">
                                <span class="xhhaocom-dataStatistics-v2-activity-badge"></span>
                                <span class="xhhaocom-dataStatistics-v2-activity-badge-text">实时数据</span>
                            </span>
                        </div>
                        <span class="xhhaocom-dataStatistics-v2-activity-subtitle">
                            捕捉最新访客动态与来源
                        </span>
                    `,a.appendChild(i);let s=t.totals||{},n=document.createElement("div");n.className="xhhaocom-dataStatistics-v2-activity-body";let r=document.createElement("div");r.className="xhhaocom-dataStatistics-v2-activity-metrics";let d=parseInt(s.visitors)||0,p=parseInt(s.views)||0,u=new Set;t.events.forEach(t=>{t.urlPath&&u.add(t.urlPath)}),r.appendChild(h("fire",p,"实时浏览量")),r.appendChild(h("account",d,"实时访客")),r.appendChild(h("eye",u.size,"活跃页面数")),n.appendChild(r);let v=t.events.slice(0,30),m=document.createElement("div");m.className="xhhaocom-dataStatistics-v2-activity-list",v.forEach(t=>{let a=document.createElement("div");a.className="xhhaocom-dataStatistics-v2-activity-item";let e=new Date(t.createdAt),i=function t(a){let e=a.getHours(),i=a.getMinutes(),s=a.getSeconds();return`${e>=12?"下午":"上午"} ${String(e>12?e-12:0===e?12:e).padStart(2,"0")}:${String(i).padStart(2,"0")}:${String(s).padStart(2,"0")}`}(e),s=t.urlPath||"/";a.innerHTML=`
                            <div class="xhhaocom-dataStatistics-v2-activity-content">
                                <div class="xhhaocom-dataStatistics-v2-activity-time-line">
                                    <span class="xhhaocom-dataStatistics-v2-activity-time">${i}</span>
                                    <span class="xhhaocom-dataStatistics-v2-activity-separator">
                                        ${l("eye",14)}
                                        <span>${s}</span>
                                    </span>
                                </div>
                                <div class="xhhaocom-dataStatistics-v2-activity-detail">
                                    <span class="xhhaocom-dataStatistics-v2-activity-person">
                                        ${l("account",14)}
                                    </span>
                                    <span class="xhhaocom-dataStatistics-v2-activity-text">${function t(a){let e=a.browser||"";e&&e.toLowerCase().includes("webview")&&(!e.includes("(")||!e.includes(")"))&&(e=e.replace(/\s*webview\s*/gi," (webview)"));let i=function t(a=""){let e=a.toUpperCase();if(!e)return"";let i=e;if(c){let s=c.of(e);s&&s!==e&&(i=s)}if(o[e]){if(i.includes("中国")){let n=i.replace(/^中国/,"");i=`中国${n}`}else i=o[e]}return i}(a.country),s=a.os?({"Mac OS":"macOS",Windows:"Windows",Android:"Android",iOS:"iOS",Linux:"Linux"})[a.os]||a.os:"",n=a.device?({desktop:"桌面电脑",mobile:"手机",tablet:"平板电脑",laptop:"笔记本"})[a.device]||a.device:"",r=i?`来自 ${i} 的访客`:"一位访客";return s&&n?r+=`在搭载 ${s} 的 ${n} 上`:s?r+=`在搭载 ${s} 的设备上`:n&&(r+=`在 ${n} 上`),r+=e?`使用 ${e} 浏览器进行访问。`:"进行访问。"}(t)}</span>
                                </div>
                            </div>
                        `,m.appendChild(a)}),n.appendChild(m),a.appendChild(n),e.appendChild(a)}).catch(t=>{console.error("[Activity]",t),e.innerHTML='<div class="xhhaocom-dataStatistics-v2-activity-error">加载失败</div>'})};n();let r=setInterval(n,3e4);e.setAttribute("data-cleanup",r)},"uptime-kuma":function t(e){e.className="xhhaocom-dataStatistics-v2-uptime-kuma",a(e);let i=()=>{s("/apis/api.data.statistics.xhhao.com/v1alpha1/uptime/status").then(t=>{e.innerHTML="";let a=t?.status,i=t?.statusPageUrl||"",s=Boolean(i),c=document.createElement(s?"a":"div");c.className="xhhaocom-dataStatistics-v2-uptime-kuma__content",c.title="查看我的项目状态",c.dataset.tipTitle="查看我的项目状态",s?(c.href=i,c.target="_blank",c.rel="noopener noreferrer"):c.classList.add("is-static");let o=document.createElement("span");o.className="xhhaocom-dataStatistics-v2-uptime-kuma-dot",o.title="查看我的项目状态",o.dataset.tipTitle="查看我的项目状态";let n=document.createElement("span");n.className="xhhaocom-dataStatistics-v2-uptime-kuma-text";let r={0:{class:"error",text:"全部业务异常",wrapperClass:"error"},1:{class:"success",text:"所有业务正常",wrapperClass:"success"},2:{class:"warning",text:"部分业务异常",wrapperClass:"warning"}}[a]||{class:"loading",text:"加载中",wrapperClass:"muted"};o.classList.add(`xhhaocom-dataStatistics-v2-uptime-kuma-dot--${r.class}`),n.textContent=r.text,c.classList.add(`xhhaocom-dataStatistics-v2-uptime-kuma__content--${r.wrapperClass}`),c.appendChild(o),c.appendChild(n),e.appendChild(c)}).catch(t=>{console.error("[Uptime Kuma Status]",t),e.innerHTML='<div class="xhhaocom-dataStatistics-v2-uptime-kuma-error">加载失败</div>'})};i();let c=setInterval(i,6e4);e.setAttribute("data-cleanup",c)},"github-pin":m,"github-stats":g,"github-top-langs":f,"github-graph":x},S=[".xhhaocom-dataStatistics-v2-traffic",".xhhaocom-dataStatistics-v2-activity",".xhhaocom-dataStatistics-v2-uptime-kuma",".xhhaocom-dataStatistics-v2-github-pin",".xhhaocom-dataStatistics-v2-github-stats",".xhhaocom-dataStatistics-v2-github-top-langs",".xhhaocom-dataStatistics-v2-github-graph"];function y(){if("loading"===document.readyState){document.addEventListener("DOMContentLoaded",y);return}document.querySelectorAll(".github-statistics-container").forEach(t=>{!function t(a){if(a.hasAttribute("data-initialized"))return;a.setAttribute("data-initialized","true");let e=(a.getAttribute("data-types")||"graph").split(",").filter(Boolean),i=["graph","stats","pin","top-langs"];e=e.sort((t,a)=>{let e=i.indexOf(t),s=i.indexOf(a);return -1===e?1:-1===s?-1:e-s}),a.innerHTML="",e.forEach((t,e)=>{if(e>0){let i=document.createElement("br");a.appendChild(i)}let s=document.createElement("div"),c=b[t];if(!c){console.warn(`[GitHub Statistics] Unknown type: ${t}`);return}if("stats"===t){let o=a.getAttribute("data-stats-locale"),n=a.getAttribute("data-stats-show-icons"),r=a.getAttribute("data-stats-theme");o&&s.setAttribute("data-locale",o),n&&s.setAttribute("data-show-icons",n),r&&s.setAttribute("data-theme",r)}else if("pin"===t){let l=a.getAttribute("data-pin-repo");l&&s.setAttribute("data-repo",l)}else if("top-langs"===t){let d=a.getAttribute("data-top-langs-layout"),h=a.getAttribute("data-top-langs-hide-progress"),p=a.getAttribute("data-top-langs-stats-format");d&&s.setAttribute("data-layout",d),h&&s.setAttribute("data-hide-progress",h),p&&s.setAttribute("data-stats-format",p)}else if("graph"===t){let u=a.getAttribute("data-graph-theme")||"minimal";s.setAttribute("data-theme",u)}s.style.display="block",s.style.width="100%",a.appendChild(s),c(s)})}(t)}),S.forEach(t=>{document.querySelectorAll(t).forEach(t=>{var a;if(t.hasAttribute("data-initialized"))return;let e=(a=t.className).includes("traffic")?"traffic":a.includes("activity")?"activity":a.includes("uptime-kuma")?"uptime-kuma":a.includes("github-pin")?"github-pin":a.includes("github-stats")?"github-stats":a.includes("github-top-langs")?"github-top-langs":a.includes("github-graph")?"github-graph":null;e&&(t.setAttribute("data-initialized","true"),function t(a,e){let i=$[e];i&&("traffic"===e||"activity"===e?i(a,function t(a){let e=a.closest("article")||a.closest(".post-content")||a.closest(".content")||a.closest('[class*="content"]'),i=a.closest("aside")||a.closest(".sidebar")||a.closest('[class*="sidebar"]');return{isEmbed:e||i,isArticle:e,isSidebar:i}}(a)):i(a))}(t,e))})})}if(window.xhhaocomDataStatisticsV2Init=y,y(),"undefined"!=typeof MutationObserver){let _=new MutationObserver(()=>{y()});_.observe(document.body,{childList:!0,subtree:!0})}}();
