!function(){"use strict";function t(t){let a=t.closest("article")||t.closest(".post-content")||t.closest(".content")||t.closest('[class*="content"]'),i=t.closest("aside")||t.closest(".sidebar")||t.closest('[class*="sidebar"]');return{isEmbed:a||i,isArticle:a,isSidebar:i}}function a(t){t.classList.contains("xhhaocom-dataStatistics-v2-traffic")?t.innerHTML='<div class="xhhaocom-dataStatistics-v2-traffic-loading">加载中</div>':t.classList.contains("xhhaocom-dataStatistics-v2-activity")?t.innerHTML='<div class="xhhaocom-dataStatistics-v2-activity-loading">加载中</div>':t.classList.contains("xhhaocom-dataStatistics-v2-uptime-kuma")?t.innerHTML='<div class="xhhaocom-dataStatistics-v2-uptime-kuma-loading">加载中</div>':t.classList.contains("xhhaocom-dataStatistics-v2-github-pin")?t.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-loading">加载中</div>':t.classList.contains("xhhaocom-dataStatistics-v2-github-stats")?t.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-loading">加载中</div>':t.classList.contains("xhhaocom-dataStatistics-v2-github-top-langs")?t.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-loading">加载中</div>':t.classList.contains("xhhaocom-dataStatistics-v2-github-graph")&&(t.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-loading">加载中</div>')}function i(t){return t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString()}function e(t){return null==t?0:"object"==typeof t&&"value"in t?parseInt(t.value)||0:parseInt(t)||0}let s="undefined"!=typeof Intl&&"function"==typeof Intl.DisplayNames?new Intl.DisplayNames(["zh-CN"],{type:"region"}):null,c={HK:"中国香港",MO:"中国澳门",TW:"中国台湾"},o={"chart-line":'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>',"account-group":'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>',account:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',fire:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg>',"lightning-bolt":'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>',eye:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>'};function n(t,a=24){let i=o[t];return i?i.replace('viewBox="0 0 24 24"',`viewBox="0 0 24 24" width="${a}" height="${a}"`):""}let r={daily:"今日概览",weekly:"近7天趋势",monthly:"近30天趋势",quarterly:"近90天趋势",yearly:"近一年趋势"};function l(t,a,e,s=!1){let c=document.createElement("div");c.className="xhhaocom-dataStatistics-v2-traffic-card",c.setAttribute("data-variant",s?"realtime":"history");let o=document.createElement("span");o.className="xhhaocom-dataStatistics-v2-traffic-icon",o.innerHTML=n(t,24);let r=document.createElement("div");r.className="xhhaocom-dataStatistics-v2-traffic-value",r.textContent=i(a);let l=document.createElement("div");if(l.className="xhhaocom-dataStatistics-v2-traffic-label",l.textContent=e,c.appendChild(o),c.appendChild(r),c.appendChild(l),s){let d=document.createElement("div");d.className="xhhaocom-dataStatistics-v2-traffic-realtime",d.dataset.tooltip="实时数据",c.appendChild(d)}return c}function d(t,a,e){let s=document.createElement("div");s.className="xhhaocom-dataStatistics-v2-activity-metric";let c=document.createElement("span");c.className="xhhaocom-dataStatistics-v2-activity-metric-icon",c.innerHTML=n(t,18);let o=document.createElement("div");o.className="xhhaocom-dataStatistics-v2-activity-metric-content";let r=document.createElement("div");r.className="xhhaocom-dataStatistics-v2-activity-metric-value",r.textContent=i(a);let l=document.createElement("div");return l.className="xhhaocom-dataStatistics-v2-activity-metric-label",l.textContent=e,o.appendChild(r),o.appendChild(l),s.appendChild(c),s.appendChild(o),s}let h=null;function v(){return h?Promise.resolve(h):fetch("/apis/api.data.statistics.xhhao.com/v1alpha1/github/config").then(t=>{if(!t.ok)throw Error(`HTTP ${t.status}`);return t.json()}).then(t=>(h=t,t))}function p(){if("loading"===document.readyState){document.addEventListener("DOMContentLoaded",p);return}[".xhhaocom-dataStatistics-v2-traffic",".xhhaocom-dataStatistics-v2-activity",".xhhaocom-dataStatistics-v2-uptime-kuma",".xhhaocom-dataStatistics-v2-github-pin",".xhhaocom-dataStatistics-v2-github-stats",".xhhaocom-dataStatistics-v2-github-top-langs",".xhhaocom-dataStatistics-v2-github-graph"].forEach(o=>{document.querySelectorAll(o).forEach(o=>{let h=o.className,p="";h.includes("traffic")?p="traffic":h.includes("activity")?p="activity":h.includes("uptime-kuma")?p="uptime-kuma":h.includes("github-pin")?p="github-pin":h.includes("github-stats")?p="github-stats":h.includes("github-top-langs")?p="github-top-langs":h.includes("github-graph")&&(p="github-graph"),p&&!o.hasAttribute("data-initialized")&&(o.setAttribute("data-initialized","true"),"traffic"===p?function t(s,c){s.className="xhhaocom-dataStatistics-v2-traffic",a(s);let o=s.getAttribute("data-type")||"weekly",n=`/apis/api.data.statistics.xhhao.com/v1alpha1/umami/visits?type=${o}`,d="/apis/api.data.statistics.xhhao.com/v1alpha1/umami/realtime";Promise.all([fetch(n).then(t=>t.ok?t.json():Promise.reject(Error(`HTTP ${t.status}`))),fetch(d).then(t=>t.ok?t.json():Promise.reject(Error(`HTTP ${t.status}`)))]).then(([t,a])=>{if(!t&&!a){s.innerHTML='<div class="xhhaocom-dataStatistics-v2-traffic-loading">暂无数据</div>';return}s.innerHTML="";let i=document.createElement("div");i.className="xhhaocom-dataStatistics-v2-traffic-section";let c=document.createElement("div");c.className="xhhaocom-dataStatistics-v2-traffic-header",c.innerHTML=`
                <div class="xhhaocom-dataStatistics-v2-traffic-title-box">
                    <span class="xhhaocom-dataStatistics-v2-traffic-title">访问统计</span>
                    <span class="xhhaocom-dataStatistics-v2-traffic-badge">${r[o]||"访问概览"}</span>
                </div>
                <span class="xhhaocom-dataStatistics-v2-traffic-subtitle">历史与实时数据一目了然</span>
            `,i.appendChild(c);let n=document.createElement("div");if(n.className="xhhaocom-dataStatistics-v2-traffic-grid",i.appendChild(n),t){let d=e(t.pageviews),h=e(t.visits),v=e(t.visitors);n.appendChild(l("chart-line",d,"页面浏览量")),n.appendChild(l("account-group",h,"访问次数")),n.appendChild(l("account",v,"访客数"))}if(a&&a.totals){let p=parseInt(a.totals.views)||0,m=parseInt(a.totals.visitors)||0;(p>0||m>0)&&(n.appendChild(l("fire",p,"实时浏览量",!0)),n.appendChild(l("lightning-bolt",m,"实时访客",!0)))}s.appendChild(i),0===s.children.length&&(s.innerHTML='<div class="xhhaocom-dataStatistics-v2-traffic-loading">暂无数据</div>')}).catch(t=>{console.error("[Traffic Stats]",t),s.innerHTML='<div class="xhhaocom-dataStatistics-v2-traffic-error">加载失败</div>'});let h=()=>{fetch(d).then(t=>t.ok?t.json():Promise.reject(Error(`HTTP ${t.status}`))).then(t=>{if(t&&t.totals){let a=s.querySelectorAll(".xhhaocom-dataStatistics-v2-traffic-card"),e=parseInt(t.totals.views)||0,c=parseInt(t.totals.visitors)||0;a.forEach(t=>{let a=t.querySelector(".xhhaocom-dataStatistics-v2-traffic-label").textContent;"实时浏览量"===a?t.querySelector(".xhhaocom-dataStatistics-v2-traffic-value").textContent=i(e):"实时访客"===a&&(t.querySelector(".xhhaocom-dataStatistics-v2-traffic-value").textContent=i(c))})}}).catch(t=>console.error("[Realtime Update]",t))};setTimeout(h,1e3);let v=setInterval(h,3e4);s.setAttribute("data-cleanup",v)}(o,t(o)):"activity"===p?function t(i,e){i.className="xhhaocom-dataStatistics-v2-activity",a(i);let o=()=>{fetch("/apis/api.data.statistics.xhhao.com/v1alpha1/umami/realtime").then(t=>t.ok?t.json():Promise.reject(Error(`HTTP ${t.status}`))).then(t=>{if(!t||!t.events||!Array.isArray(t.events)||0===t.events.length){i.innerHTML='<div class="xhhaocom-dataStatistics-v2-activity-empty">暂无活动</div>';return}i.innerHTML="";let a=document.createElement("div");a.className="xhhaocom-dataStatistics-v2-activity-section";let e=document.createElement("div");e.className="xhhaocom-dataStatistics-v2-activity-header",e.innerHTML=`
                        <div class="xhhaocom-dataStatistics-v2-activity-title-box">
                            <span class="xhhaocom-dataStatistics-v2-activity-title">近30分钟网站活动</span>
                            <span class="xhhaocom-dataStatistics-v2-activity-badge-wrapper">
                                <span class="xhhaocom-dataStatistics-v2-activity-badge"></span>
                                <span class="xhhaocom-dataStatistics-v2-activity-badge-text">实时数据</span>
                            </span>
                        </div>
                        <span class="xhhaocom-dataStatistics-v2-activity-subtitle">
                            捕捉最新访客动态与来源
                        </span>
                    `,a.appendChild(e);let o=t.totals||{},r=document.createElement("div");r.className="xhhaocom-dataStatistics-v2-activity-body";let l=document.createElement("div");l.className="xhhaocom-dataStatistics-v2-activity-metrics";let h=parseInt(o.visitors)||0,v=parseInt(o.views)||0,p=new Set;t.events.forEach(t=>{t.urlPath&&p.add(t.urlPath)}),l.appendChild(d("fire",v,"实时浏览量")),l.appendChild(d("account",h,"实时访客")),l.appendChild(d("eye",p.size,"活跃页面数")),r.appendChild(l);let m=t.events.slice(0,30),u=document.createElement("div");u.className="xhhaocom-dataStatistics-v2-activity-list",m.forEach(t=>{let a=document.createElement("div");a.className="xhhaocom-dataStatistics-v2-activity-item";let i=new Date(t.createdAt),e=function t(a){let i=a.getHours(),e=a.getMinutes(),s=a.getSeconds();return`${i>=12?"下午":"上午"} ${String(i>12?i-12:0===i?12:i).padStart(2,"0")}:${String(e).padStart(2,"0")}:${String(s).padStart(2,"0")}`}(i),o=t.urlPath||"/";a.innerHTML=`
                            <div class="xhhaocom-dataStatistics-v2-activity-content">
                                <div class="xhhaocom-dataStatistics-v2-activity-time-line">
                                    <span class="xhhaocom-dataStatistics-v2-activity-time">${e}</span>
                                    <span class="xhhaocom-dataStatistics-v2-activity-separator">
                                        ${n("eye",14)}
                                        <span>${o}</span>
                                    </span>
                                </div>
                                <div class="xhhaocom-dataStatistics-v2-activity-detail">
                                    <span class="xhhaocom-dataStatistics-v2-activity-person">
                                        ${n("account",14)}
                                    </span>
                                    <span class="xhhaocom-dataStatistics-v2-activity-text">${function t(a){let i=a.browser||"";i&&i.toLowerCase().includes("webview")&&(i.includes("(")&&i.includes(")")||(i=i.replace(/\s*webview\s*/gi," (webview)")));let e=function t(a=""){let i=a.toUpperCase();if(!i)return"";let e=i;if(s){let o=s.of(i);o&&o!==i&&(e=o)}if(c[i]){if(e.includes("中国")){let n=e.replace(/^中国/,"");e=`中国${n}`}else e=c[i]}return e}(a.country),o=a.os?({"Mac OS":"macOS",Windows:"Windows",Android:"Android",iOS:"iOS",Linux:"Linux"})[a.os]||a.os:"",n=a.device?({desktop:"桌面电脑",mobile:"手机",tablet:"平板电脑",laptop:"笔记本"})[a.device]||a.device:"",r="";return r=e?`来自 ${e} 的访客`:"一位访客",o&&n?r+=`在搭载 ${o} 的 ${n} 上`:o?r+=`在搭载 ${o} 的设备上`:n&&(r+=`在 ${n} 上`),i?r+=`使用 ${i} 浏览器进行访问。`:r+="进行访问。",r}(t)}</span>
                                </div>
                            </div>
                        `,u.appendChild(a)}),r.appendChild(u),a.appendChild(r),i.appendChild(a)}).catch(t=>{console.error("[Activity]",t),i.innerHTML='<div class="xhhaocom-dataStatistics-v2-activity-error">加载失败</div>'})};o();let r=setInterval(o,3e4);i.setAttribute("data-cleanup",r)}(o,t(o)):"uptime-kuma"===p?function t(i){i.className="xhhaocom-dataStatistics-v2-uptime-kuma",a(i);let e=()=>{fetch("/apis/api.data.statistics.xhhao.com/v1alpha1/uptime/status").then(t=>t.ok?t.json():Promise.reject(Error(`HTTP ${t.status}`))).then(t=>{i.innerHTML="";let a=t?.status,e=t?.statusPageUrl||"",s=Boolean(e),c=document.createElement(s?"a":"div");c.className="xhhaocom-dataStatistics-v2-uptime-kuma__content",c.title="查看我的项目状态",c.dataset.tipTitle="查看我的项目状态",s?(c.href=e,c.target="_blank",c.rel="noopener noreferrer"):c.classList.add("is-static");let o=document.createElement("span");o.className="xhhaocom-dataStatistics-v2-uptime-kuma-dot",o.title="查看我的项目状态",o.dataset.tipTitle="查看我的项目状态";let n=document.createElement("span");n.className="xhhaocom-dataStatistics-v2-uptime-kuma-text";let r="loading",l="加载中";0===a?(r="error",l="全部业务异常",c.classList.add("xhhaocom-dataStatistics-v2-uptime-kuma__content--error")):1===a?(r="success",l="所有业务正常",c.classList.add("xhhaocom-dataStatistics-v2-uptime-kuma__content--success")):2===a?(r="warning",l="部分业务异常",c.classList.add("xhhaocom-dataStatistics-v2-uptime-kuma__content--warning")):c.classList.add("xhhaocom-dataStatistics-v2-uptime-kuma__content--muted"),o.classList.add(`xhhaocom-dataStatistics-v2-uptime-kuma-dot--${r}`),n.textContent=l,c.appendChild(o),c.appendChild(n),i.appendChild(c)}).catch(t=>{console.error("[Uptime Kuma Status]",t),i.innerHTML='<div class="xhhaocom-dataStatistics-v2-uptime-kuma-error">加载失败</div>'})};e();let s=setInterval(e,6e4);i.setAttribute("data-cleanup",s)}(o):"github-pin"===p?function t(i){i.className="xhhaocom-dataStatistics-v2-github-pin",a(i);let e=i.getAttribute("data-repo")||"";v().then(t=>{if(!t.username)throw Error("GitHub 用户名未配置");let a=new URLSearchParams;a.append("username",t.username),e&&a.append("repo",e);let s=t.proxyUrl+"api/pin/?"+a.toString(),c=document.createElement("img");c.src=s,c.alt="GitHub Repository Stats",c.style.maxWidth="100%",c.onerror=()=>{i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'},i.innerHTML="",i.appendChild(c)}).catch(t=>{console.error("[GitHub Pin]",t),i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'})}(o):"github-stats"===p?function t(i){i.className="xhhaocom-dataStatistics-v2-github-stats",a(i);let e=i.getAttribute("data-locale")||"",s=i.getAttribute("data-show-icons")||"",c=i.getAttribute("data-theme")||"";v().then(t=>{if(!t.username)throw Error("GitHub 用户名未配置");let a=new URLSearchParams;a.append("username",t.username),e&&a.append("locale",e),s&&a.append("show_icons",s),c&&a.append("theme",c);let o=t.proxyUrl+"api?"+a.toString(),n=document.createElement("img");n.src=o,n.alt="GitHub Stats",n.style.maxWidth="100%",n.onerror=()=>{i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'},i.innerHTML="",i.appendChild(n)}).catch(t=>{console.error("[GitHub Stats]",t),i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'})}(o):"github-top-langs"===p?function t(i){i.className="xhhaocom-dataStatistics-v2-github-top-langs",a(i);let e=i.getAttribute("data-layout")||"",s=i.getAttribute("data-hide-progress")||"",c=i.getAttribute("data-stats-format")||"";v().then(t=>{if(!t.username)throw Error("GitHub 用户名未配置");let a=new URLSearchParams;a.append("username",t.username),e&&a.append("layout",e),s&&a.append("hide_progress",s),c&&a.append("stats_format",c);let o=t.proxyUrl+"api/top-langs/?"+a.toString(),n=document.createElement("img");n.src=o,n.alt="GitHub Top Languages",n.style.maxWidth="100%",n.onerror=()=>{i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'},i.innerHTML="",i.appendChild(n)}).catch(t=>{console.error("[GitHub Top Langs]",t),i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'})}(o):"github-graph"===p&&function t(i){i.className="xhhaocom-dataStatistics-v2-github-graph",a(i);let e=i.getAttribute("data-theme")||"minimal";v().then(t=>{if(!t.username)throw Error("GitHub 用户名未配置");let a=new URLSearchParams;a.append("username",t.username),e&&a.append("theme",e);let s=t.graphProxyUrl+"graph?"+a.toString(),c=document.createElement("img");c.src=s,c.alt="GitHub Activity Graph",c.style.maxWidth="100%",c.onerror=()=>{i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'},i.innerHTML="",i.appendChild(c)}).catch(t=>{console.error("[GitHub Graph]",t),i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'})}(o))})})}if(window.xhhaocomDataStatisticsV2Init=p,p(),"undefined"!=typeof MutationObserver){let m=new MutationObserver(()=>{p()});m.observe(document.body,{childList:!0,subtree:!0})}}();
