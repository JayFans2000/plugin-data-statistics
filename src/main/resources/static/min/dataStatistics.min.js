!function(){"use strict";function t(t){let a=t.closest("article")||t.closest(".post-content")||t.closest(".content")||t.closest('[class*="content"]'),i=t.closest("aside")||t.closest(".sidebar")||t.closest('[class*="sidebar"]');return{isEmbed:a||i,isArticle:a,isSidebar:i}}function a(t){t.classList.contains("xhhaocom-dataStatistics-v2-traffic")?t.innerHTML='<div class="xhhaocom-dataStatistics-v2-traffic-loading">加载中</div>':t.classList.contains("xhhaocom-dataStatistics-v2-activity")?t.innerHTML='<div class="xhhaocom-dataStatistics-v2-activity-loading">加载中</div>':t.classList.contains("xhhaocom-dataStatistics-v2-uptime-kuma")?t.innerHTML='<div class="xhhaocom-dataStatistics-v2-uptime-kuma-loading">加载中</div>':t.classList.contains("xhhaocom-dataStatistics-v2-github-pin")?t.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-loading">加载中</div>':t.classList.contains("xhhaocom-dataStatistics-v2-github-stats")?t.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-loading">加载中</div>':t.classList.contains("xhhaocom-dataStatistics-v2-github-top-langs")?t.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-loading">加载中</div>':t.classList.contains("xhhaocom-dataStatistics-v2-github-graph")&&(t.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-loading">加载中</div>')}function i(t){return t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString()}let e="undefined"!=typeof Intl&&"function"==typeof Intl.DisplayNames?new Intl.DisplayNames(["zh-CN"],{type:"region"}):null,s={HK:"中国香港",MO:"中国澳门",TW:"中国台湾"},c={"chart-line":'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>',"account-group":'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>',account:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',fire:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg>',"lightning-bolt":'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>',eye:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>'};function o(t,a=24){let i=c[t];return i?i.replace('viewBox="0 0 24 24"',`viewBox="0 0 24 24" width="${a}" height="${a}"`):""}let n={daily:"今日概览",weekly:"近7天趋势",monthly:"近30天趋势",quarterly:"近90天趋势",yearly:"近一年趋势"};function r(t,a,e,s=!1){let c=document.createElement("div");c.className="xhhaocom-dataStatistics-v2-traffic-card",c.setAttribute("data-variant",s?"realtime":"history");let n=document.createElement("span");n.className="xhhaocom-dataStatistics-v2-traffic-icon",n.innerHTML=o(t,24);let r=document.createElement("div");r.className="xhhaocom-dataStatistics-v2-traffic-value",r.textContent=i(a);let l=document.createElement("div");if(l.className="xhhaocom-dataStatistics-v2-traffic-label",l.textContent=e,c.appendChild(n),c.appendChild(r),c.appendChild(l),s){let d=document.createElement("div");d.className="xhhaocom-dataStatistics-v2-traffic-realtime",d.dataset.tooltip="实时数据",c.appendChild(d)}return c}function l(t,a,e){let s=document.createElement("div");s.className="xhhaocom-dataStatistics-v2-activity-metric";let c=document.createElement("span");c.className="xhhaocom-dataStatistics-v2-activity-metric-icon",c.innerHTML=o(t,18);let n=document.createElement("div");n.className="xhhaocom-dataStatistics-v2-activity-metric-content";let r=document.createElement("div");r.className="xhhaocom-dataStatistics-v2-activity-metric-value",r.textContent=i(a);let l=document.createElement("div");return l.className="xhhaocom-dataStatistics-v2-activity-metric-label",l.textContent=e,n.appendChild(r),n.appendChild(l),s.appendChild(c),s.appendChild(n),s}let d=null;function h(){return d?Promise.resolve(d):fetch("/apis/api.data.statistics.xhhao.com/v1alpha1/github/config").then(t=>{if(!t.ok)throw Error(`HTTP ${t.status}`);return t.json()}).then(t=>(d=t,t))}function v(){if("loading"===document.readyState){document.addEventListener("DOMContentLoaded",v);return}[".xhhaocom-dataStatistics-v2-traffic",".xhhaocom-dataStatistics-v2-activity",".xhhaocom-dataStatistics-v2-uptime-kuma",".xhhaocom-dataStatistics-v2-github-pin",".xhhaocom-dataStatistics-v2-github-stats",".xhhaocom-dataStatistics-v2-github-top-langs",".xhhaocom-dataStatistics-v2-github-graph"].forEach(c=>{document.querySelectorAll(c).forEach(c=>{let d=c.className,v="";d.includes("traffic")?v="traffic":d.includes("activity")?v="activity":d.includes("uptime-kuma")?v="uptime-kuma":d.includes("github-pin")?v="github-pin":d.includes("github-stats")?v="github-stats":d.includes("github-top-langs")?v="github-top-langs":d.includes("github-graph")&&(v="github-graph"),v&&!c.hasAttribute("data-initialized")&&(c.setAttribute("data-initialized","true"),"traffic"===v?function t(e,s){e.className="xhhaocom-dataStatistics-v2-traffic",a(e);let c=e.getAttribute("data-type")||"weekly",o=`/apis/api.data.statistics.xhhao.com/v1alpha1/umami/visits?type=${c}`,l="/apis/api.data.statistics.xhhao.com/v1alpha1/umami/realtime";Promise.all([fetch(o).then(t=>t.ok?t.json():Promise.reject(Error(`HTTP ${t.status}`))),fetch(l).then(t=>t.ok?t.json():Promise.reject(Error(`HTTP ${t.status}`)))]).then(([t,a])=>{if(!t&&!a){e.innerHTML='<div class="xhhaocom-dataStatistics-v2-traffic-loading">暂无数据</div>';return}e.innerHTML="";let i=document.createElement("div");i.className="xhhaocom-dataStatistics-v2-traffic-section";let s=document.createElement("div");s.className="xhhaocom-dataStatistics-v2-traffic-header",s.innerHTML=`
                <div class="xhhaocom-dataStatistics-v2-traffic-title-box">
                    <span class="xhhaocom-dataStatistics-v2-traffic-title">访问统计</span>
                    <span class="xhhaocom-dataStatistics-v2-traffic-badge">${n[c]||"访问概览"}</span>
                </div>
                <span class="xhhaocom-dataStatistics-v2-traffic-subtitle">历史与实时数据一目了然</span>
            `,i.appendChild(s);let o=document.createElement("div");if(o.className="xhhaocom-dataStatistics-v2-traffic-grid",i.appendChild(o),t){let l=parseInt(t.pageviews)||0,d=parseInt(t.visits)||0,h=parseInt(t.visitors)||0;o.appendChild(r("chart-line",l,"页面浏览量")),o.appendChild(r("account-group",d,"访问次数")),o.appendChild(r("account",h,"访客数"))}if(a&&a.totals){let v=parseInt(a.totals.views)||0,p=parseInt(a.totals.visitors)||0;(v>0||p>0)&&(o.appendChild(r("fire",v,"实时浏览量",!0)),o.appendChild(r("lightning-bolt",p,"实时访客",!0)))}e.appendChild(i),0===e.children.length&&(e.innerHTML='<div class="xhhaocom-dataStatistics-v2-traffic-loading">暂无数据</div>')}).catch(t=>{console.error("[Traffic Stats]",t),e.innerHTML='<div class="xhhaocom-dataStatistics-v2-traffic-error">加载失败</div>'});let d=()=>{fetch(l).then(t=>t.ok?t.json():Promise.reject(Error(`HTTP ${t.status}`))).then(t=>{if(t&&t.totals){let a=e.querySelectorAll(".xhhaocom-dataStatistics-v2-traffic-card"),s=parseInt(t.totals.views)||0,c=parseInt(t.totals.visitors)||0;a.forEach(t=>{let a=t.querySelector(".xhhaocom-dataStatistics-v2-traffic-label").textContent;"实时浏览量"===a?t.querySelector(".xhhaocom-dataStatistics-v2-traffic-value").textContent=i(s):"实时访客"===a&&(t.querySelector(".xhhaocom-dataStatistics-v2-traffic-value").textContent=i(c))})}}).catch(t=>console.error("[Realtime Update]",t))};setTimeout(d,1e3);let h=setInterval(d,3e4);e.setAttribute("data-cleanup",h)}(c,t(c)):"activity"===v?function t(i,c){i.className="xhhaocom-dataStatistics-v2-activity",a(i);let n=()=>{fetch("/apis/api.data.statistics.xhhao.com/v1alpha1/umami/realtime").then(t=>t.ok?t.json():Promise.reject(Error(`HTTP ${t.status}`))).then(t=>{if(!t||!t.events||!Array.isArray(t.events)||0===t.events.length){i.innerHTML='<div class="xhhaocom-dataStatistics-v2-activity-empty">暂无活动</div>';return}i.innerHTML="";let a=document.createElement("div");a.className="xhhaocom-dataStatistics-v2-activity-section";let c=document.createElement("div");c.className="xhhaocom-dataStatistics-v2-activity-header",c.innerHTML=`
                        <div class="xhhaocom-dataStatistics-v2-activity-title-box">
                            <span class="xhhaocom-dataStatistics-v2-activity-title">近30分钟网站活动</span>
                            <span class="xhhaocom-dataStatistics-v2-activity-badge-wrapper">
                                <span class="xhhaocom-dataStatistics-v2-activity-badge"></span>
                                <span class="xhhaocom-dataStatistics-v2-activity-badge-text">实时数据</span>
                            </span>
                        </div>
                        <span class="xhhaocom-dataStatistics-v2-activity-subtitle">
                            捕捉最新访客动态与来源
                        </span>
                    `,a.appendChild(c);let n=t.totals||{},r=document.createElement("div");r.className="xhhaocom-dataStatistics-v2-activity-body";let d=document.createElement("div");d.className="xhhaocom-dataStatistics-v2-activity-metrics";let h=parseInt(n.visitors)||0,v=parseInt(n.views)||0,p=new Set;t.events.forEach(t=>{t.urlPath&&p.add(t.urlPath)}),d.appendChild(l("fire",v,"实时浏览量")),d.appendChild(l("account",h,"实时访客")),d.appendChild(l("eye",p.size,"活跃页面数")),r.appendChild(d);let m=t.events.slice(0,30),u=document.createElement("div");u.className="xhhaocom-dataStatistics-v2-activity-list",m.forEach(t=>{let a=document.createElement("div");a.className="xhhaocom-dataStatistics-v2-activity-item";let i=new Date(t.createdAt),c=function t(a){let i=a.getHours(),e=a.getMinutes(),s=a.getSeconds();return`${i>=12?"下午":"上午"} ${String(i>12?i-12:0===i?12:i).padStart(2,"0")}:${String(e).padStart(2,"0")}:${String(s).padStart(2,"0")}`}(i),n=t.urlPath||"/";a.innerHTML=`
                            <div class="xhhaocom-dataStatistics-v2-activity-content">
                                <div class="xhhaocom-dataStatistics-v2-activity-time-line">
                                    <span class="xhhaocom-dataStatistics-v2-activity-time">${c}</span>
                                    <span class="xhhaocom-dataStatistics-v2-activity-separator">
                                        ${o("eye",14)}
                                        <span>${n}</span>
                                    </span>
                                </div>
                                <div class="xhhaocom-dataStatistics-v2-activity-detail">
                                    <span class="xhhaocom-dataStatistics-v2-activity-person">
                                        ${o("account",14)}
                                    </span>
                                    <span class="xhhaocom-dataStatistics-v2-activity-text">${function t(a){let i=a.browser||"";i&&i.toLowerCase().includes("webview")&&(i.includes("(")&&i.includes(")")||(i=i.replace(/\s*webview\s*/gi," (webview)")));let c=function t(a=""){let i=a.toUpperCase();if(!i)return"";let c=i;if(e){let o=e.of(i);o&&o!==i&&(c=o)}if(s[i]){if(c.includes("中国")){let n=c.replace(/^中国/,"");c=`中国${n}`}else c=s[i]}return c}(a.country),o=a.os?({"Mac OS":"macOS",Windows:"Windows",Android:"Android",iOS:"iOS",Linux:"Linux"})[a.os]||a.os:"",n=a.device?({desktop:"桌面电脑",mobile:"手机",tablet:"平板电脑",laptop:"笔记本"})[a.device]||a.device:"",r="";return r=c?`来自 ${c} 的访客`:"一位访客",o&&n?r+=`在搭载 ${o} 的 ${n} 上`:o?r+=`在搭载 ${o} 的设备上`:n&&(r+=`在 ${n} 上`),i?r+=`使用 ${i} 浏览器进行访问。`:r+="进行访问。",r}(t)}</span>
                                </div>
                            </div>
                        `,u.appendChild(a)}),r.appendChild(u),a.appendChild(r),i.appendChild(a)}).catch(t=>{console.error("[Activity]",t),i.innerHTML='<div class="xhhaocom-dataStatistics-v2-activity-error">加载失败</div>'})};n();let r=setInterval(n,3e4);i.setAttribute("data-cleanup",r)}(c,t(c)):"uptime-kuma"===v?function t(i){i.className="xhhaocom-dataStatistics-v2-uptime-kuma",a(i);let e=()=>{fetch("/apis/api.data.statistics.xhhao.com/v1alpha1/uptime/status").then(t=>t.ok?t.json():Promise.reject(Error(`HTTP ${t.status}`))).then(t=>{i.innerHTML="";let a=t?.status,e=t?.statusPageUrl||"",s=Boolean(e),c=document.createElement(s?"a":"div");c.className="xhhaocom-dataStatistics-v2-uptime-kuma__content",c.title="查看我的项目状态",c.dataset.tipTitle="查看我的项目状态",s?(c.href=e,c.target="_blank",c.rel="noopener noreferrer"):c.classList.add("is-static");let o=document.createElement("span");o.className="xhhaocom-dataStatistics-v2-uptime-kuma-dot",o.title="查看我的项目状态",o.dataset.tipTitle="查看我的项目状态";let n=document.createElement("span");n.className="xhhaocom-dataStatistics-v2-uptime-kuma-text";let r="loading",l="加载中";0===a?(r="error",l="全部业务异常",c.classList.add("xhhaocom-dataStatistics-v2-uptime-kuma__content--error")):1===a?(r="success",l="所有业务正常",c.classList.add("xhhaocom-dataStatistics-v2-uptime-kuma__content--success")):2===a?(r="warning",l="部分业务异常",c.classList.add("xhhaocom-dataStatistics-v2-uptime-kuma__content--warning")):c.classList.add("xhhaocom-dataStatistics-v2-uptime-kuma__content--muted"),o.classList.add(`xhhaocom-dataStatistics-v2-uptime-kuma-dot--${r}`),n.textContent=l,c.appendChild(o),c.appendChild(n),i.appendChild(c)}).catch(t=>{console.error("[Uptime Kuma Status]",t),i.innerHTML='<div class="xhhaocom-dataStatistics-v2-uptime-kuma-error">加载失败</div>'})};e();let s=setInterval(e,6e4);i.setAttribute("data-cleanup",s)}(c):"github-pin"===v?function t(i){i.className="xhhaocom-dataStatistics-v2-github-pin",a(i);let e=i.getAttribute("data-repo")||"";h().then(t=>{if(!t.username)throw Error("GitHub 用户名未配置");let a=new URLSearchParams;a.append("username",t.username),e&&a.append("repo",e);let s=t.proxyUrl+"api/pin/?"+a.toString(),c=document.createElement("img");c.src=s,c.alt="GitHub Repository Stats",c.style.maxWidth="100%",c.onerror=()=>{i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'},i.innerHTML="",i.appendChild(c)}).catch(t=>{console.error("[GitHub Pin]",t),i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'})}(c):"github-stats"===v?function t(i){i.className="xhhaocom-dataStatistics-v2-github-stats",a(i);let e=i.getAttribute("data-locale")||"",s=i.getAttribute("data-show-icons")||"",c=i.getAttribute("data-theme")||"";h().then(t=>{if(!t.username)throw Error("GitHub 用户名未配置");let a=new URLSearchParams;a.append("username",t.username),e&&a.append("locale",e),s&&a.append("show_icons",s),c&&a.append("theme",c);let o=t.proxyUrl+"api?"+a.toString(),n=document.createElement("img");n.src=o,n.alt="GitHub Stats",n.style.maxWidth="100%",n.onerror=()=>{i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'},i.innerHTML="",i.appendChild(n)}).catch(t=>{console.error("[GitHub Stats]",t),i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'})}(c):"github-top-langs"===v?function t(i){i.className="xhhaocom-dataStatistics-v2-github-top-langs",a(i);let e=i.getAttribute("data-layout")||"",s=i.getAttribute("data-hide-progress")||"",c=i.getAttribute("data-stats-format")||"";h().then(t=>{if(!t.username)throw Error("GitHub 用户名未配置");let a=new URLSearchParams;a.append("username",t.username),e&&a.append("layout",e),s&&a.append("hide_progress",s),c&&a.append("stats_format",c);let o=t.proxyUrl+"api/top-langs/?"+a.toString(),n=document.createElement("img");n.src=o,n.alt="GitHub Top Languages",n.style.maxWidth="100%",n.onerror=()=>{i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'},i.innerHTML="",i.appendChild(n)}).catch(t=>{console.error("[GitHub Top Langs]",t),i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'})}(c):"github-graph"===v&&function t(i){i.className="xhhaocom-dataStatistics-v2-github-graph",a(i);let e=i.getAttribute("data-theme")||"minimal";h().then(t=>{if(!t.username)throw Error("GitHub 用户名未配置");let a=new URLSearchParams;a.append("username",t.username),e&&a.append("theme",e);let s=t.graphProxyUrl+"graph?"+a.toString(),c=document.createElement("img");c.src=s,c.alt="GitHub Activity Graph",c.style.maxWidth="100%",c.onerror=()=>{i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'},i.innerHTML="",i.appendChild(c)}).catch(t=>{console.error("[GitHub Graph]",t),i.innerHTML='<div class="xhhaocom-dataStatistics-v2-github-error">加载失败</div>'})}(c))})})}if(window.xhhaocomDataStatisticsV2Init=v,v(),"undefined"!=typeof MutationObserver){let p=new MutationObserver(()=>{v()});p.observe(document.body,{childList:!0,subtree:!0})}}();
